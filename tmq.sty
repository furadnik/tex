\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tmq}[TMQ LaTeX Macros]

\RequirePackage{graphicx, xcolor}
\RequirePackage{mfirstuc}
\RequirePackage{amsmath,amssymb,amsthm,textcomp,thm-restate}
\RequirePackage{listings}
\RequirePackage{parskip}
\RequirePackage{dsfont} % nicer R,Q,...
\RequirePackage{stmaryrd} % lightning symbol n stuff
\RequirePackage[noend]{algpseudocode}
\RequirePackage{tikz}
\RequirePackage{indentfirst}
\RequirePackage{enumitem}
\usepackage[automake]{glossaries-extra}
\usepackage{geometry}

% hyperlinks
\usepackage[pdfusetitle]{hyperref}
\usepackage{zref-clever}
\hypersetup{colorlinks=false}
\zcsetup{sort,cap,nameinlink=false}

% default commands
\newcommand\AlgIn{\emph{Input: }}%
\newcommand\AlgOut{\emph{Output: }}%
\newcommand{\tmqdefi}{Definition}%
\newcommand{\tmqnotation}{Notation}%
\newcommand{\tmqthm}{Theorem}%
\newcommand{\tmqlemma}{Lemma}%
\newcommand{\tmqalgo}{Algorithm}%
\newcommand{\tmqobs}{Observation}%
\newcommand{\tmqprop}{Proposition}%
\newcommand{\tmqinvar}{Invariant}%
\newcommand{\tmqcor}{Corollary}%
\newcommand{\tmqexamp}{Example}%
\newcommand{\tmqexercise}{Exercise}%
\newcommand{\tmqfact}{Fact}%
\newcommand{\tmqnote}{Note}%
\newcommand{\tmqproof}{Proof}%
\newcommand{\glostitle}{Glossary}%

% language support
\RequirePackage{babel}
\RequirePackage{csquotes}
\newcommand{\czech}{%
	\selectlanguage{czech}%
	\zcsetup{lang=czech}%
	\renewcommand{\lstlistingname}{Ukázka kódu}%
	\renewcommand{\lstlistlistingname}{Seznam ukázek kódu}%
	\renewcommand\AlgIn{\emph{Vstup: }}%
	\renewcommand\AlgOut{\emph{Výstup: }}%
	\renewcommand{\tmqdefi}{Definice}%
	\renewcommand{\tmqnotation}{Značení}%
	\renewcommand{\tmqthm}{Věta}%
	\renewcommand{\tmqlemma}{Lemma}%
	\renewcommand{\tmqalgo}{Algoritmus}%
	\renewcommand{\tmqobs}{Pozorování}%
	\renewcommand{\tmqprop}{Tvrzení}%
	\renewcommand{\tmqinvar}{Invariant}%
	\renewcommand{\tmqcor}{Důsledek}%
	\renewcommand{\tmqexamp}{Příklad}%
	\renewcommand{\tmqexercise}{Cvičení}%
	\renewcommand{\tmqfact}{Fakt}%
	\renewcommand{\tmqnote}{Poznámka}%
	\renewcommand{\tmqproof}{Důkaz}%
	\renewcommand{\glostitle}{Seznam zkratek}%
}
\newcommand{\english}{%
	\selectlanguage{english}%
	\zcsetup{lang=english}%
	\renewcommand{\lstlistingname}{Ukázka kódu}%
	\renewcommand{\lstlistlistingname}{Seznam ukázek kódu}%
	\renewcommand\AlgIn{\emph{Input: }}%
	\renewcommand\AlgOut{\emph{Output: }}%
	\renewcommand{\tmqdefi}{Definition}%
	\renewcommand{\tmqnotation}{Notation}%
	\renewcommand{\tmqthm}{Theorem}%
	\renewcommand{\tmqlemma}{Lemma}%
	\renewcommand{\tmqalgo}{Algorithm}%
	\renewcommand{\tmqobs}{Observation}%
	\renewcommand{\tmqprop}{Proposition}%
	\renewcommand{\tmqinvar}{Invariant}%
	\renewcommand{\tmqcor}{Corollary}%
	\renewcommand{\tmqexamp}{Example}%
	\renewcommand{\tmqexercise}{Exercise}%
	\renewcommand{\tmqfact}{Fact}%
	\renewcommand{\tmqnote}{Note}%
	\renewcommand{\tmqproof}{Proof}%
	\renewcommand{\glostitle}{Glossary}%
}
\DeclareOption{czech}{\czech}
\DeclareOption{english}{\english}


% theorem counter
\newcounter{thms}
\numberwithin{equation}{thms}
\numberwithin{thms}{subsection}
\DeclareOption{incrementalthms}{%
	\renewcommand*{\thethms}{%
		\ifnum\value{subsection}=0 %
			\ifnum\value{section}=0 %
			\else\thesection.\fi\else\thesubsection.\fi\arabic{thms}%
	}
}

% custom proof environment with better optional title
\newenvironment{prf}[1][]%
  {\begin{proof}[\tmqproof\ifx#1\empty\else~#1\fi.]}
  {\end{proof}}


% label enumerate via (N) instead of N.
\setlist[enumerate]{label=(\arabic*),ref=(\arabic*)}

% axioms & invariants
\newlist{axioms}{enumerate}{1}
\setlist[axioms]{label=(A\arabic*),ref=(A\arabic*)}
\newlist{invariants}{enumerate}{1}
\setlist[invariants]{label=(I\arabic*),ref=(I\arabic*)}

% small matrix with parenths
\newenvironment{psmallmatrix} {\left(\begin{smallmatrix}} {\end{smallmatrix}\right)}

% algorithmic macros
\algdef{SN}[SUBALG]{Indent}{EndIndent}{}{}%
\algdef{SN}[SUBALG]{Procedure}{EndProcedure}[2]{\algofont{#1}({#2}):}{}%

% acronyms
\setabbreviationstyle[acronym]{long-short}
\makeglossaries

% text spread on page % TODO: as option
\DeclareOption{nogeometry}{%
	\let\tmqnogeometry\relax
}

% custom theorem style
\DeclareOption{nothmstyle}{%
\let\tmqnotheoremstyle\relax
}
\DeclareOption{color}{%
\let\tmqcolor\relax
}

% custom qed
\renewcommand{\qedsymbol}{$\blacksquare$}
\def\qed{{\parfillskip=0pt\allowbreak\hfill\nobreak $\blacksquare$\par}}


\ProcessOptions
 
% page geometry
\ifx\tmqnogeometry\undefined
	\geometry{left=25mm,right=25mm,bindingoffset=0mm,top=20mm,bottom=20mm}
\fi

\ifx\tmqnotheoremstyle\undefined
	\def\theorempre{1.7ex plus 1.2ex minus 0.6ex}
	\def\theorempost{1.5ex plus 1.2ex minus 0.6ex}
	\newtheoremstyle{Sdefi}{\theorempre}{\theorempost}{\normalfont}{0pt}
	{\ifx\tmqcolor\relax\color{blue}\fi\scshape}{. }{0pt}{{\thmname{#1 }}{\thmnumber{#2}}{\thmnote{ ({#3})}}}
	\newtheoremstyle{Sthm}{\theorempre}{\theorempost}{\normalfont}{0pt}
	{\ifx\tmqcolor\relax\color{orange}\fi\scshape}{. }{0pt}{{\thmname{#1 }}{\thmnumber{#2}}{\thmnote{ ({#3})}}}
	\newtheoremstyle{Sex}{\theorempre}{\theorempost}{\normalfont}{0pt}
	{\ifx\tmqcolor\relax\color{purple}\fi\scshape}{. }{0pt}{{\thmname{#1 }}{\thmnumber{#2}}{\thmnote{ ({#3})}}}
\fi


% theorem environments
\ifx\tmqnotheoremstyle\undefined\theoremstyle{Sdefi}\else\theoremstyle{definition}\fi
\newtheorem{defi}[thms]{\protect\tmqdefi}
\newtheorem{notation}[thms]{\protect\tmqnotation}
\ifx\tmqnotheoremstyle\undefined\theoremstyle{Sthm}\else\theoremstyle{theorem}\fi
\newtheorem{thm}[thms]{\protect\tmqthm}
\newtheorem{lemma}[thms]{\protect\tmqlemma}
\newtheorem{algo}[thms]{\protect\tmqalgo}
\newtheorem{obs}[thms]{\protect\tmqobs}
\newtheorem{prop}[thms]{\protect\tmqprop}
\newtheorem{invar}[thms]{\protect\tmqinvar}
\newtheorem{cor}[thms]{\protect\tmqcor}
\ifx\tmqnotheoremstyle\undefined\theoremstyle{Sex}\else\theoremstyle{remark}\fi
\newtheorem{examp}[thms]{\protect\tmqexamp}
\newtheorem{exercise}[thms]{\protect\tmqexercise}
\newtheorem{fact}[thms]{\protect\tmqfact}
\newtheorem{note}[thms]{\protect\tmqnote}


% reference types
\zcLanguageSetup{english}{
	type=axiom,
		name-sg=axiom,
		name-pl=axioms,
		Name-sg=Axiom,
		Name-pl=Axioms,
	type=invar,
		name-sg=invariant,
		name-pl=invariants,
		Name-sg=Invariant,
		Name-pl=Invariants,
}
\zcDeclareLanguage[variants={1,2,3,4,5,6,7}]{czech}
\zcLanguageSetup{czech}{
	type = axiom,
		variant = 1,
			name-sg=axiom,
			name-pl=axiomy,
			Name-sg=Axiom,
			Name-pl=Axiomy,
	type = invar,
		variant = 1,
			name-sg=invariant,
			name-pl=invarianty,
			Name-sg=Invariant,
			Name-pl=Invarianty,
}


% misc macros
\def\restrict#1#2{#1\!\restriction\!#2}
\def\doubleunderline#1{\underline{\underline{#1}}}
\def\rand#1{\text{#1}}
\def\randvec#1{\textbf{#1}}

\def\suchthat{;\,}
\def\given{;}

\def\pot#1{\fce{\mathcal{P}}{#1}}
\def\potfin#1{\left[ #1 \right]^{<\omega}}
\def\xor{\mathbin{\oplus}}
\def\divides{\mathbin{\backslash}}

% functions with auto parenths
\def\bfce#1#2{#1\!\bigl(#2\bigr)}
\def\fce#1#2{\mathchoice{#1\!\left(#2\right)}{#1\!\left(#2\right)}{#1(#2)}{#1(#2)}}
\def\fceb#1#2{\mathchoice{#1\!\left[#2\right]}{#1\!\left[#2\right]}{#1[#2]}{#1[#2]}}
\def\fcec#1#2{#1\{#2\}}
\def\fces#1#2{#1\!\left<#2\right>}

\def\algofont{\textsc}
\def\algref#1{\algofont{\nameref{#1}}}
\def\algorithm#1#2{\fce{\algofont{#1}}{#2}}
\newenvironment{algor}[3]{\begin{minipage}{\textwidth}\begin{algo}[#1]\ \\ \AlgIn #2\\\AlgOut #3 \begin{algorithmic}[1]}{\end{algorithmic}\end{algo}\end{minipage}}

\def\set#1{\left\{#1\right\}}
\def\arr#1{\left[#1\right]}

\DeclareMathOperator{\conv}{conv}
\DeclareMathOperator{\cov}{cov}
\DeclareMathOperator{\var}{var}
\DeclareMathOperator{\fin}{Fin}
\DeclareMathOperator{\poly}{poly}
\DeclareMathOperator{\dlog}{dlog}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\rng}{rng}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\trace}{trace}
\DeclareMathOperator*{\mini}{mini}
\DeclareMathOperator*{\maxi}{maxi}
\DeclareMathOperator*{\avg}{avg}

\def\funcs#1#2{{ {}^{#1}#2}} % množina funkcí z #1 do #2
\def\ggrid#1{\boxplus_{#1}} % k x k grid

\def\isomorph{\cong}
\def\dd{\,\text{d}}
\def\compl#1{\overline {#1}}
\def\tuple#1{\left< #1 \right>}

\def\range#1{\left[ #1 \right]}

% vectors
\def\tr{{\!\top\!}}
\def\trans#1{{#1}^{\tr}}
\def\vec{\boldsymbol}
\def\Rmm#1#2{\R^{#1 \times #2}}
\def\Rm#1{\R^{#1}}
\def\ii#1#2{_{#1,#2}}
\def\inv#1{#1^{\inve}}
\def\inve{-1}
\def\I#1{I_{#1}}
\def\zero{\vec{o}}

% probability and random variables
\def\pr#1{\fceb{\Pr}{#1}}
\def\prfa#1#2{\fceb{\Pr_{#1}}{#2}}
\def\prt#1{\fceb{\Pr}{\text{#1}}}
\def\prfat#1#2{\prfa{#1}{\text{#2}}}
\def\vrv{\textbf}
\def\rv{\text}
\DeclareMathOperator*{\E}{\mathds{E}}
\newcommand\ev[1][]{\fceb \E_{#1}}

% distributions
\def\dist#1{\Delta^{#1}} % set of distributions of set #1
\def\Normd{\mathcal{N}}
\def\normd{\fce{\Normd}}
\def\normdf#1#2#3{\normd{#3 \given #1, #2}}
\DeclareMathOperator{\Berd}{Ber}
\def\berd{\fce{\Berd}}
\def\berdf#1#2{\berd{#2 \given #1}}
\DeclareMathOperator{\Poisd}{Pois}
\def\poisd{\fce{\Poisd}}
\def\poisdf#1#2{\poisd{#2 \given #1}}

\def\Rowsp#1{\mathcal{R}\!\left(#1\right)}
\def\Colsp#1{\mathcal{S}\!\left(#1\right)}

\def\norm#1{\left\lVert #1 \right\rVert }
\def\aabsolute#1{\left\lVert #1 \right\rVert }
\def\absolute#1{\left\lvert #1 \right\rvert }
\def\dotpr#1#2{\langle #1 , #2 \rangle}
\def\randin{\in_R}

\def\emod#1{\mathbin{\equiv_{#1}}}
\def\po{\mathbin{\circ}}

\def\disjcup{\mathbin{\dot\cup}}
\def\bigdisjcup{\mathop{\dot\bigcup}}

\def\deltap{\delta^+}
\def\deltam{\delta^-}

\def\deq{\mathbin{:=}}
\def \lHeq{\mathbin{\stackrel{l'H}{=}}}
\def\concat{\cdot}

\def\R{\mathds{R}}
\def\Q{\mathds{Q}}
\def\N{\mathbb{N}}
\def\C{\mathds{C}}
\def\Z{\mathds{Z}}
\def\K{\mathbb{K}}
\def\P{\mathbb{P}}
\def\V{\mathbb{V}}
\def\F{\mathds{F}}
\def\ff{\mathcal{F}}
\def\T{\mathbb{T}}
\def\O{\mathcal{O}}
\def\M{\mathcal{M}}
\def\integ#1#2#3#4{\int_{#1}^{#2} #4 \text{d}#3}
\def\iinteg#1#2#3#4{\iint_{#1} #4 \text{d}#2\text{d}#3}

% mohutnost
\def\mohge{\succcurlyeq}
\def\mohgt{\succ}
\def\mohle{\preccurlyeq}
\def\mohlt{\prec}
\def\moheq{\approx}

% implications
\def\implies{\rightarrow}
\def\impliedby{\leftarrow}
\def\Implies{\Longrightarrow}
\def\Impliedby{\Longleftarrow}
\def\iff{\leftrightarrow}
\def\Iff{\Longleftrightarrow}

% complexity classes
\def\problem{\textsc}
\def\problemClass{\textsf}
\def\np{\problemClass{NP}}
\def\p{\problemClass{P}}
\def\conp{\problemClass{coNP}}
\def\fnp{\problemClass{FNP}}
